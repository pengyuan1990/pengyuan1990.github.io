<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="a normal people"><title>golang-函数 | pengyuan1990</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.3.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.3.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">golang-函数</h1><a id="logo" href="/.">pengyuan1990</a><p class="description">keep learning</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">golang-函数</h1><div class="post-meta">Mar 24, 2017<span> | </span><span class="category"><a href="/categories/programming/">编程</a><a href="/categories/programming/学习笔记/">学习笔记</a><a href="/categories/programming/学习笔记/原创/">原创</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h1 id="golang学习笔记-四"><a href="#golang学习笔记-四" class="headerlink" title="golang学习笔记 四"></a>golang学习笔记 四</h1><p>golang函数属于第一类对象即可在运行期创建，可以用作函数参数或者返回值，同时可以存入变量。由于golang函数的这些特征，所以golang种函数闭包使用的也是比较多的。</p>
<h2 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h2><ul>
<li>golang函数参数不支持有默认值的可选参数同时也不支持命名参数，所以函数调用时必须按照签名顺序传递参数，即使是“_”命名参数也不能忽略。<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(x,y <span class="keyword">int</span> ,z <span class="keyword">string</span>, _ <span class="keyword">bool</span>)</span></span>&#123;</div><div class="line">    <span class="built_in">println</span>(fmt.Sprintf(<span class="string">"x=%d y=%d z=%s"</span>,x,y,z))</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">// test(1,2,"3") //编译报错</span></div><div class="line">    test(<span class="number">1</span>,<span class="number">2</span>,<span class="string">"3"</span>,<span class="literal">true</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><em>注意</em><br>golang参数在函数内部是作为局部变量使用的，所以不能在通过作用域内再次定义同名变量<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(x,y <span class="keyword">int</span> ,z <span class="keyword">string</span>, _ <span class="keyword">bool</span>)</span></span>&#123;</div><div class="line">    <span class="comment">//  y := 10 //编译报错</span></div><div class="line">    <span class="comment">//  var z = "ss"</span></div><div class="line">    &#123;<span class="comment">// 内部作用域</span></div><div class="line">        y := <span class="number">10</span></div><div class="line">        <span class="keyword">var</span> z = <span class="string">"ss"</span> </div><div class="line">        <span class="built_in">println</span>(fmt.Sprintf(<span class="string">"x=%d y=%d z=%s"</span>,x,y,z)) <span class="comment">// 1,10,ss</span></div><div class="line">    &#125;</div><div class="line">    <span class="built_in">println</span>(fmt.Sprintf(<span class="string">"x=%d y=%d z=%s"</span>,x,y,z)) <span class="comment">// 1,2,3</span></div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">// test(1,2,"3") //编译报错</span></div><div class="line">    test(<span class="number">1</span>,<span class="number">2</span>,<span class="string">"3"</span>,<span class="literal">true</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在golang参数传递过程中个，所有的类型都是<strong>值拷贝传递</strong>的。差别只是拷贝的值的类容而已。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(x *<span class="keyword">int</span>)</span></span>&#123;</div><div class="line">    <span class="comment">// 这个地方x也是一个指针变量，所以两次打印的地址不一样，但是把p保存的a的地址拷贝给了x</span></div><div class="line">    <span class="comment">// 所以函数里面通过*获取x对象的值就是a的内存，对*x的操作实际就是对a本身的操作。</span></div><div class="line">    fmt.Printf(<span class="string">"指针对象的地址 %p, 指针对象保存的目标值 %v\n"</span>,&amp;x,x)</div><div class="line">    *x = <span class="number">10</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 实现传出参数，即将x的值赋给外面的参数，注意和test方法的区别。！</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test1</span><span class="params">(p **<span class="keyword">int</span>)</span></span>&#123;</div><div class="line">    x := <span class="number">100</span></div><div class="line">    *p := &amp;x</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    a := <span class="number">100</span></div><div class="line">    p := &amp;a <span class="comment">//p保存了a的地址，所以拷贝的值就是地址，</span></div><div class="line">    fmt.Printf(<span class="string">"指针对象的地址 %p, 指针对象保存的目标值 %v\n"</span>,&amp;p,p) </div><div class="line">    test(p) <span class="comment">// 将a的地址拷贝给变量</span></div><div class="line">    fmt.Println(a)</div><div class="line">    </div><div class="line">    <span class="comment">// 将指针变量的地址传个了方法</span></div><div class="line">    <span class="keyword">var</span> x *<span class="keyword">int</span> </div><div class="line">    test1(&amp;x)</div><div class="line">    fmt.Println(*x)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>变参<br>变参本质上就是切片(slice)，变参只能接受同一类型的参数，同时只能放在最后！同时也可以将切片当作参数，但是在使用需要将切片进行展开操作(a[]…)。<br>当参数是切片的时候，复制的是切片本身(<strong>切片本身本身只是一个对数组引用的结构体！！</strong>)而不是底层数组,所以在函数内部对切片进行处理也会影响外面的数据。<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(s <span class="keyword">string</span> ,a ...<span class="keyword">int</span>)</span></span>&#123;</div><div class="line">   fmt.Printf(<span class="string">"%T  %v\n"</span>,a,a)</div><div class="line">   <span class="keyword">for</span> i := <span class="keyword">range</span> a &#123;</div><div class="line">       a[i] += <span class="number">100</span></div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">   test(<span class="string">"abc"</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) <span class="comment">// []int,[1，2，3，4]</span></div><div class="line">   a := []<span class="keyword">int</span>&#123;<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;</div><div class="line">   test(<span class="string">"aaa"</span>,a...) <span class="comment">// []int,[5，6，7，8]</span></div><div class="line">   fmt.Println(a) <span class="comment">// 105,106,107,108</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p>匿名函数是指没有定义函数名的函数多用与闭包实现。匿名函数赋值给变量和普通函数有着本质的区别。普通函数和匿名函数都可以作为struct的字段或通过通道传递。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">type</span> cale <span class="keyword">struct</span>&#123;</div><div class="line">        mul <span class="function"><span class="keyword">func</span><span class="params">(x,y <span class="keyword">int</span>)</span> <span class="title">int</span></span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="title">x</span> := <span class="title">cale</span>&#123;</div><div class="line">        mul: <span class="function"><span class="keyword">func</span><span class="params">(x,y <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123;</div><div class="line">            <span class="keyword">return</span> x*y</div><div class="line">        &#125;,</div><div class="line">    &#125;</div><div class="line">    fmt.Println(x.mul(<span class="number">2</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">    c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span> <span class="title">int</span>,2)</span></div><div class="line">    <span class="title">c</span> &lt;- <span class="title">func</span> <span class="params">(x,y <span class="keyword">int</span>)</span> <span class="title">int</span> &#123;</div><div class="line">        <span class="keyword">return</span> x+y</div><div class="line">    &#125;</div><div class="line">    fmt.Println((&lt;-c)(<span class="number">4</span>,<span class="number">5</span>))</div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">   test()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>闭包<br>闭包是在其词法上下文引用了自由变量的函数或者说是函数和其引用的环境的组合体。<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 简单闭包例子</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(x <span class="keyword">int</span>)</span><span class="title">func</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</div><div class="line">        x = x*<span class="number">10</span></div><div class="line">        fmt.Println(x)</div><div class="line">    &#125;</div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">   f := test(<span class="number">10</span>)</div><div class="line">   f()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>##注意##<br>闭包是通过指针引用环境变量的，所以就可能导致变量的生命周期的延长。由此就出现了<em>延迟求值</em>的现象。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(x <span class="keyword">int</span>)</span> []<span class="title">func</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">var</span> s []<span class="function"><span class="keyword">func</span><span class="params">()</span></span></div><div class="line">    <span class="title">for</span> <span class="title">i</span>:=0;<span class="title">i</span>&lt;<span class="title">x</span>;<span class="title">i</span>++ &#123;</div><div class="line">        s = <span class="built_in">append</span>(s,<span class="function"><span class="keyword">func</span> <span class="params">()</span></span> &#123;</div><div class="line">            fmt.Println(&amp;i,i) <span class="comment">// 所有都是使用的函数的i变量，只是保存了i的地址，在最后调用的时候才会取计算i的值</span></div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> s</div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test1</span><span class="params">(x <span class="keyword">int</span>)</span> []<span class="title">func</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">var</span> s []<span class="function"><span class="keyword">func</span><span class="params">()</span></span></div><div class="line">    <span class="title">for</span> <span class="title">i</span>:=0;<span class="title">i</span>&lt;<span class="title">x</span>;<span class="title">i</span>++ &#123;</div><div class="line">        i := i <span class="comment">// 在添加都局部函数变量的时候定义了布局变量，这也各个函数就的参数就是不同。</span></div><div class="line">        s = <span class="built_in">append</span>(s,<span class="function"><span class="keyword">func</span> <span class="params">()</span></span> &#123;</div><div class="line">            fmt.Println(&amp;i,i)</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> s</div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">   <span class="keyword">for</span> _,f := <span class="keyword">range</span> test(<span class="number">5</span>)&#123;</div><div class="line">       f() <span class="comment">// 打印结果都是一样的5</span></div><div class="line">   &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> _,f := <span class="keyword">range</span> test1(<span class="number">5</span>)&#123;</div><div class="line">       f() <span class="comment">// 打印结果0,1,2,3,4</span></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</div><div class="tags"><a href="/tags/golang/">golang</a></div><div class="post-nav"><a href="/2017/03/27/golang-数据/" class="pre">golang-数据</a><a href="/2017/03/22/golang-表达式/" class="next">golang-表达式</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/web-安全/">web 安全</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web-安全/笔记/">笔记</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web前端/">web前端</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web前端/学习笔记/">学习笔记</a><span class="category-list-count">5</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">编程</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/学习笔记/">学习笔记</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/学习笔记/原创/">原创</a><span class="category-list-count">7</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/xss/" style="font-size: 15px;">xss</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/你不知道的js/" style="font-size: 15px;">你不知道的js</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/06/09/es6/">es6</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/13/css-secrets/">css-secrets</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/04/youdontknowjs/">youdontknowjs</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/02/css-list/">css-list</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/21/web-security/">web-security</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/21/progressive-Enhancement/">渐进增强开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/borwser-kernel/">borwser-kernel</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/15/css-layout/">css-layout</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/12/hexo/">hexo</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/11/css-day1/">css-day1</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.3.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a> |<span>联系博主：<a href="mailto:506756261@qq.com" target="_blank" class="fa fa-email"> </a><a href="http://weibo.com/u/3406493032/home" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/pengyuan1990" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">pengyuan</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=1.3.0"></script></body></html>